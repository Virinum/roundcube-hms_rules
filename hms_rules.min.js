window.rcmail&&rcmail.addEventListener("init",function(a){if(rcmail.env.disabled_rules){var b=rcmail.get_label("hms_rules.disabled");$.each(rcmail.env.disabled_rules,function(d,c){$("#rcmrow"+c).addClass("disabled").children("td").append(" - "+b);});}if(rcmail.env.rules_reload){window.top.location.href=rcmail.env.comm_path+"&_action=plugin.rules&_rid="+rcmail.env.rules_reload;}rcmail.register_command("plugin.hmsrules-add",function(){rcmail.hmsrules_add();},true);rcmail.register_command("plugin.hmsrules-delete",function(){rcmail.hmsrules_del();});rcmail.register_command("plugin.hmsrules-moveup",function(){rcmail.hmsrules_moveup();});rcmail.register_command("plugin.hmsrules-movedown",function(){rcmail.hmsrules_movedown();});rcmail.addEventListener("plugin.rules-reload",function(d){var c=(d>0)?"&_rid="+d:"";location.href="./?_task=settings&_action=plugin.rules"+c;});if(rcmail.gui_objects.rulelist){rcmail.rules_list=new rcube_list_widget(rcmail.gui_objects.rulelist,{multiselect:false,draggable:false,keyboard:true});rcmail.rules_list.addEventListener("select",function(c){rcmail.hmsrules_select(c);}).init();if(rcmail.env.rules_selected){rcmail.rules_list.select(rcmail.env.rules_selected);}}if(rcmail.gui_objects.ruleform){rcmail.register_command("plugin.hmsrule-submit",function(){rcmail.set_busy(true,"loading");rcmail.gui_objects.ruleform.submit();},true);rcmail.register_command("plugin.hmsrule-abort",function(c){if(c!=null){rcmail.set_busy(true,"loading");location.href="./?_task=settings&_action=plugin.rules-edit&_rid="+c;}},true);rcmail.register_command("plugin.hmsrule-criteria-edit",function(c){if(c!=null){id=c.split(":");rcmail.set_busy(true,"loading");location.href="./?_task=settings&_action=plugin.rules-criteria&_rid="+id[0]+"&_cid="+id[1];}},true);rcmail.register_command("plugin.hmsrule-criteria-delete",function(c){if(c!=null){id=c.split(":");rcmail.set_busy(true,"loading");location.href="./?_task=settings&_action=plugin.rules-edit&_act=criteriadelete&_rid="+id[0]+"&_cid="+id[1];}},true);rcmail.register_command("plugin.hmsrule-action-edit",function(c){if(c!=null){id=c.split(":");rcmail.set_busy(true,"loading");location.href="./?_task=settings&_action=plugin.rules-action&_rid="+id[0]+"&_aid="+id[1];}},true);rcmail.register_command("plugin.hmsrule-action-moveup",function(c){if(c!=null){id=c.split(":");rcmail.set_busy(true,"loading");location.href="./?_task=settings&_action=plugin.rules-edit&_act=actionup&_rid="+id[0]+"&_aid="+id[1];}},true);rcmail.register_command("plugin.hmsrule-action-movedown",function(c){if(c!=null){id=c.split(":");rcmail.set_busy(true,"loading");location.href="./?_task=settings&_action=plugin.rules-edit&_act=actiondown&_rid="+id[0]+"&_aid="+id[1];}},true);rcmail.register_command("plugin.hmsrule-action-delete",function(c){if(c!=null){id=c.split(":");rcmail.set_busy(true,"loading");location.href="./?_task=settings&_action=plugin.rules-edit&_act=actiondelete&_rid="+id[0]+"&_aid="+id[1];}},true);}$("input:not(:hidden):first").focus();});rcube_webmail.prototype.hmsrules_select=function(a){var b=a.get_single_selection();if(b!=null){this.load_hmsruleframe(b);this.enable_command("plugin.hmsrules-delete",true);this.enable_command("plugin.hmsrules-moveup",(a.get_first_row()!=b));this.enable_command("plugin.hmsrules-movedown",(a.get_last_row()!=b));}};rcube_webmail.prototype.hmsrules_add=function(){this.load_hmsruleframe();this.rules_list.clear_selection();this.enable_command("plugin.hmsrules-delete","plugin.hmsrules-moveup","plugin.hmsrules-movedown",false);};rcube_webmail.prototype.hmsrules_del=function(){var a=this.rules_list.get_single_selection();if(a!=null&&confirm(this.get_label("hms_rules.ruledeleteconfirm"))){this.set_busy(true);this.http_post("plugin.rules-actions","_act=delete&_rid="+a);this.set_busy(false);}};rcube_webmail.prototype.hmsrules_moveup=function(){var a=this.rules_list.get_single_selection();if(a!=null){this.set_busy(true);this.http_post("plugin.rules-actions","_act=moveup&_rid="+a);this.set_busy(false);}};rcube_webmail.prototype.hmsrules_movedown=function(){var a=this.rules_list.get_single_selection();if(a!=null){this.set_busy(true);this.http_post("plugin.rules-actions","_act=movedown&_rid="+a);this.set_busy(false);}};rcube_webmail.prototype.load_hmsruleframe=function(c){var b=typeof(c)!="undefined"&&c!=null;if(this.env.contentframe&&window.frames&&window.frames[this.env.contentframe]){target=window.frames[this.env.contentframe];var a="";target.location.href=this.env.comm_path+"&_action=plugin.rules-edit"+(b?"&_rid="+c:"")+"&_unlock="+a;}};